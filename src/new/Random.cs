namespace Core;

/// <summary>
/// Pseudo random numbers using Linear-Feedback Shift Register (LFSR).
/// </summary>
public static class RandomNumber
{
    
    // 16-bit number
    // taps: 16,15,13,4
    public static void Next16(ref ushort seed)
    {
        //ushort taps = 0B_00010000_00001011;
        //bool result = (seed & taps) == taps
        bool tap16 = (seed & 0B_00000000_00000001) == 0B_00000000_00000001;
        bool tap15 = (seed & 0B_00000000_00000010) == 0B_00000000_00000010;
        bool tap13 = (seed & 0B_00000000_00001000) == 0B_00000000_00001000;
        bool tap4  = (seed & 0B_00010000_00000000) == 0B_00010000_00000000;
        seed >>= 1;
        if (tap16 ^ tap15 ^ tap13 ^ tap4) { seed |= 0B_10000000_00000000; }
    }
    
    // Generate 16-bit number
    // public static ushort Make16(ref ushort seed)
    // {
    //     ushort result = 0B_00000000_00000000;
    //     Next16(seed);
    //     (seed & 0B_10000000_00000000);
    // }

    // 32-bit number
    // taps: 32,22,2,1
    public static void Next32(ref uint seed)
    {
        bool tap32 = (seed & 0B_00000000_00000000_00000000_00000001) == 0B_00000000_00000000_00000000_00000001;
        bool tap22 = (seed & 0B_00000000_00000000_00000100_00000000) == 0B_00000000_00000000_00000100_00000000;
        bool tap2  = (seed & 0B_01000000_00000000_00000000_00000000) == 0B_01000000_00000000_00000000_00000000;
        bool tap1  = (seed & 0B_10000000_00000000_00000000_00000000) == 0B_10000000_00000000_00000000_00000000;
        seed >>= 1;
        if (tap32 ^ tap22 ^ tap2 ^ tap1) { seed |= 0B_10000000_00000000_00000000_00000000; }
    }
    
    // 64-bit number 
    // taps: 64,63,61,60
    public static void Next64(ref ulong seed)
    {
        bool tap64 = (seed & 0B_00000000_00000000_00000000_00000000_00000000_00000000_00000000_00000001) == 0B_00000000_00000000_00000000_00000000_00000000_00000000_00000000_00000001;
        bool tap63 = (seed & 0B_00000000_00000000_00000000_00000000_00000000_00000000_00000000_00000010) == 0B_00000000_00000000_00000000_00000000_00000000_00000000_00000000_00000010;
        bool tap61 = (seed & 0B_00000000_00000000_00000000_00000000_00000000_00000000_00000000_00001000) == 0B_00000000_00000000_00000000_00000000_00000000_00000000_00000000_00001000;
        bool tap60 = (seed & 0B_00000000_00000000_00000000_00000000_00000000_00000000_00000000_00010000) == 0B_00000000_00000000_00000000_00000000_00000000_00000000_00000000_00010000;
        seed >>= 1;
        if (tap64 ^ tap63 ^ tap61 ^ tap60) { seed |= 0B_10000000_00000000_00000000_00000000_00000000_00000000_00000000_00000000; }
    }
}
